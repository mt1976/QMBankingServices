PROGRAM MWT.RESTORE

   CALL M.START("MWT.RESTORE")
   CALL M.HEADER("Code & Data Restore/Install Processor")


   FN.TXFR= "MWT.TRANSFER" ; FV.VOC = "" ; ID.VOC = ""
   CALL M.OPENFILE(FN.TXFR, FV.TXFR, @TRUE, "")

   CALL M.INPUT("Filename", FN.RESTORE)
   CALL M.INPUT("Item Name", ID.RESTORE)

   IF FN.RESTORE # '' AND ID.RESTORE # '' THEN

      IF ID.RESTORE = "*" THEN
         STMT = "SELECT ":FN.TXFR
         CALL M.CRT.ACTION("EXECUTE", STMT)
         EXECUTE STMT

         LOOP
            READNEXT ID.PROCESS ELSE EXIT
            ID.RESTORE = ID.PROCESS
            GOSUB RESTORE.ITEM
         REPEAT

      END ELSE
         GOSUB RESTORE.ITEM
      END
   END

   CALL M.STOP("")

   STOP



RESTORE.ITEM:
   * FV.RESTORE=""
   * CALL M.OPENFILE(FN.RESTORE, FV.RESTORE, @TRUE, "")
   * TODO SPLIT THE ID.RESTORE INTO ORIGINAL PARTS!!!

   *ID.TXFR = FN.RESTORE:"!":ID.RESTORE

   RESTORE.PART = CONVERT("~", @FM, ID.RESTORE)
   RESTORE.FILE = RESTORE.PART<1>
   RESTORE.ID = RESTORE.PART<2>
   IF RESTORE.FILE = FN.RESTORE THEN
      STMT = "DELETE ":RESTORE.FILE:" ":DQUOTE(RESTORE.ID)
      CALL M.EXECUTE(STMT, @TRUE)


      STMT = "COPY FROM ":FN.TXFR:" TO ":RESTORE.FILE:" ":DQUOTE(ID.RESTORE):",":DQUOTE(RESTORE.ID)
      CALL M.EXECUTE(STMT, @TRUE)

   END
   RETURN

END
