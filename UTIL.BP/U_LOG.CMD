SUBROUTINE U_LOG.CMD(LOG.DATA,R.CMD.EVENT)
$INCLUDE UTIL.BP UTIL.H

   FN.UTIL.CMD.LOG = "UTIL.CMD.LOG" ; FV.UTIL.CMD.LOG = "" ; STOP.ON.ERROR = @TRUE ; ERROR.TEXT = ""
   CALL U_OPENFILE(FN.UTIL.CMD.LOG, FV.UTIL.CMD.LOG, STOP.ON.ERROR, ERROR.TEXT)
   FN.UTIL.CMD.EVENT = "UTIL.CMD.EVENT" ; FV.UTIL.CMD.EVENT = "" ; STOP.ON.ERROR = @TRUE ; ERROR.TEXT = ""
   CALL U_OPENFILE(FN.UTIL.CMD.EVENT, FV.UTIL.CMD.EVENT, STOP.ON.ERROR, ERROR.TEXT)

   ID.UTIL.CMD.LOG = ""
   CALL U_UNIQUE.ID(ID.UTIL.CMD.LOG)

   CALL U_WRITE(FV.UTIL.CMD.LOG, ID.UTIL.CMD.LOG, LOG.DATA, STOP.ON.ERROR, ERROR.TEXT)

   IF R.CMD.EVENT<U_LOG_EVENT> = "" THEN  R.CMD.EVENT<U_LOG_EVENT> = "UNKOWN"
   R.CMD.EVENT<U_LOG_DATE>     = TODAY()
   R.CMD.EVENT<U_LOG_TIME>     = TIME()
   R.CMD.EVENT<U_LOG_USER>     = @USER
   R.CMD.EVENT<U_LOG_ID>       = ID.UTIL.CMD.LOG
   R.CMD.EVENT<U_LOG_TTY>      = @TTY
   R.CMD.EVENT<U_LOG_USERNO>   = @USERNO
   R.CMD.EVENT<U_LOG_PATH>     = @PATH
   R.CMD.EVENT<U_LOG_WHO>      = @WHO
   R.CMD.EVENT<U_LOG_SENTANCE> = @SENTENCE

   CALL U_WRITE(FV.UTIL.CMD.EVENT, ID.UTIL.CMD.LOG, R.CMD.EVENT, STOP.ON.ERROR, ERROR.TEXT)

   RETURN
END
